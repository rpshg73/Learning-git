Version 3 code here.